function compareVersion(e,r){e=e.split("."),r=r.split(".");for(var t=Math.max(e.length,r.length);e.length<t;)e.push("0");for(;r.length<t;)r.push("0");for(var o=0;o<t;o++){var s=parseInt(e[o]),a=parseInt(r[o]);if(s>a)return 1;if(s<a)return-1}return 0}let requestPromise=function(e){let{url:r,method:t="POST",data:o,header:s={"Content-Type":"application/json"}}=e;return wx.verifyLog("requestPromise start:",r,o),new Promise((e,a)=>{wx.request({url:r,method:t,data:o,header:s,success(r){wx.verifyLog("requestPromise success:",r),e(r)},fail(e){wx.verifyLog("requestPromise error:",e),a(e)}})})},request=function(e,r){let{url:t,method:o="POST",data:s,header:a={"Content-Type":"application/json"}}=e;wx.verifyLog("requestPromise start:",t,s);try{wx.request({url:t,method:o,data:s,header:a,success(e){wx.verifyLog("request success:",e),200===e.statusCode&&e.data?0===e.data.ErrorCode?r({ErrorCode:0,Data:e.data.Data}):r({ErrorCode:e.data.ErrorCode,ErrorMsg:e.data.ErrorMsg,Data:e.data}):r({ErrorCode:-107,ErrorMsg:"request请求异常，请稍后重试"})},fail(e){wx.verifyLog("request error:",e),e.errMsg.indexOf("request:fail Unable to resolve host")>=0||e.errMsg.indexOf("request:fail 似乎已断开与互联网的连接")>=0?r({ErrorCode:101,ErrorMsg:"网络异常，请稍后重试"}):r({ErrorCode:-107,ErrorMsg:"request请求异常，请稍后重试"})}})}catch(e){wx.verfiyLog("request error:",e),r({ErrorCode:-107,ErrorMsg:"request请求异常"})}},uploadFile=function(e,r){console.log(e),wx.uploadFile({url:e.url,filePath:e.filePath,name:"file",formData:e.data,success:e=>{if(wx.verifyLog("uploadFile| ",e),200===e.statusCode){console.log(e);let t=JSON.parse(e.data);console.log("resTemp"),console.log(t),0===t.ErrorCode?(wx.verifyLog(this.data),r({ErrorCode:0,Data:t})):r({ErrorCode:t.ErrorCode,ErrorMsg:"上传视频失败，"+t.ErrorMsg})}else r({ErrorCode:101,ErrorMsg:"上传视频失败 "+e.statusCode})},fail:e=>{wx.verifyLog("upload img fail",e),r({ErrorCode:101,ErrorMsg:"上传视频失败, "+e.errMsg})}}).onProgressUpdate(e=>{this.setData({"livingbody.uploadProcess":e.progress-10<0?0:e.progress-10}),console.log("progress",e.progress),console.log("already upload data",e.totalBytesSent),console.log("all upload data",e.totalBytesExpectedToSend)})},validate=function(e,r){switch(r){case"signature":return/^\S{74}={2}$/.test(e);case"appid":return"string"==typeof e&&/^\d{4}$/.test(e);case"uid":return e;case"sms_phone":return/^(13[0-9]|14[5-9]|15[012356789]|16[6]|17[0135678]|18[0-9]|19[8-9])\d{8}$/.test(e);case"sms_verifyCode":return/^\d{4}$/.test(e);case"idcard":return IDNumberValid(e);case"idname":return/^[\u4e00-\u9fa5]{1,15}[·•]?[\u4e00-\u9fa5]{1,15}$/.test(e);case"idaddress":return!!e;case"end_path":return/^\//.test(e);case"token":return/^[a-zA-Z0-9-]{36}$/.test(e)}},showModal=function(e,r){wx.showModal({title:e,content:r.replace(/(^\s*)|(\s*$)/g,""),showCancel:!1,confirmText:"我知道了",confirmColor:"#2d72f1",success:function(e){e.confirm||e.cancel}})},IDNumberValid=function(e){if(!e||!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(e))return!1;if(!{11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"}[e.substr(0,2)])return!1;if(18===e.length){e=e.split("");const r=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],t=[1,0,"X",9,8,7,6,5,4,3,2];let o=0,s=0,a=0;for(let t=0;t<17;t++)o+=(s=e[t])*(a=r[t]);let d=t[o%11];if("x"===e[17]||"X"===e[17])return d===e[17].toUpperCase();if(d!==parseInt(e[17]))return!1}return!0};module.exports={requestPromise:requestPromise,validate:validate,compareVersion:compareVersion,showModal:showModal,request:request,uploadFile:uploadFile};